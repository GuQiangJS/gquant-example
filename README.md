数据文件 `300378_daily.csv` 为300378日线数据（不复权）

读取复权数据代码：

```python
# 原始未复权数据
ori_data_df = gquant.pd.read_csv('300378_daily.csv', 
                                 encoding='utf-8', 
                                 parse_dates=[0], 
                                 dtype={'code': str}).set_index(['date', 'code'])
ori_data = QA.QAData.QA_DataStruct_Stock_day(ori_data_df)
# 前复权数据
ori_data_df_qfq = ori_data.to_qfq().data
```

**代码修正记录**：
```python
# LocalDataAPI.kline方法中遗失对start,end的处理。造成数据读取有误。参考：策略测试-通道策略-ATR波幅通道.ipynb
# 增加以下代码：
if start and end:
    return df[start:end]
elif start:
    return df[start:]
elif end:
    return df[:end]
# KLManager._fetch_pick_time_kl_pd方法中遗失对start,end的处理。造成数据读取有误。参考：策略测试-通道策略-ATR波幅通道.ipynb
# 调用abupy.MarketBu.ABuSymbolPd.make_kl_df时增加传入start和end：
data = abupy.MarketBu.ABuSymbolPd.make_kl_df(target_symbol,start=self.benchmark.start,end=self.benchmark.end)
```
以上修正需要在其他策略测试时注意。否则可能会造成使用非起始日开始的数据回测时无法回测到数据。

**测试说明**

- 所有测试均使用300378做测试。
- 所有测试时间段为 2014-01-01 ~ 2018-12-31

**所有的简单测试结果都并不准确，仅做示例参考。** 因为：

1. 以当日收盘价作为判断依据的同时，以当日作为建仓或清仓标准是不合理的。
2. 没有考虑交易手续费

# 回测结果

- 所有测试均只采用了300378一只股票进行测试。
- 回测时间段为`2019-01-01`~`2019-12-31`。
- 回测时仓位控制为固定每次购买100股。（如无特殊说明。仓位管理的测试可能会在其他项目中）
- 回测初始资金10000元（这也是采用固定仓位大小的原因和好处）。
- 回测时避免了简单测试的弊端。采用了第二日购买/卖出的方式，并且计算了手续费。

## ATR波幅通道策略

从使用历史数据测试结果来看，所有策略的R值均在3以上。应该还算是一个不错的策略。使用`2019年数据（2019-01-01~2019-12-31）`的测试结果也对其有了一定程度的验证。R值达到了`4.12`。

### 策略说明：

- 买入：收盘价上穿20日移动均线+20日ATR
- 买入（加仓）：收盘价高于20日移动均线+20日ATR，并且收盘价超过现有持仓的当时买入价+2倍买入日ATR
- 卖出：收盘价下穿20日移动均线+20日ATR
- 卖出：持仓达到20日（以历史数据的亏损交易平均持仓时间为值），并且当日价格小于或等于现有持仓的当时买入价

### 回测结果：

|                                                                     |   盈亏总额 |   最终价值 |   交易次数 |   盈利次数 |   亏损次数 |   盈利比率 |   每笔交易平均盈亏额 |   盈利交易平均盈利额 |   亏损交易平均亏损额 |    R |   最大回撤 |   买入平均花费 |
|:--------------------------------------------------------------------|-----------:|-----------:|-----------:|-----------:|-----------:|-----------:|---------------------:|---------------------:|---------------------:|-----:|-----------:|---------------:|
| ATR波幅通道                                           |   16441.3  |    24605.9 |         52 |         28 |         24 |   0.538462 |              280.795 |              587.189 |             -76.665  | 3.66 |  -0.223107 |        2209.86 |
| ATR波幅通道-增加最多持仓天数的卖出策略                |   15617.1  |    25531.8 |         52 |         26 |         26 |   0.5      |              272.662 |              600.656 |             -55.3321 | 4.93 |  -0.222266 |        2235.8  |
| ATR波幅通道-增加止损(1倍ATR）止盈（10倍ATR）          |   16441.3  |    24605.9 |         52 |         28 |         24 |   0.538462 |              280.795 |              587.189 |             -76.665  | 3.66 |  -0.223107 |        2209.86 |
| ATR波幅通道-增加有持仓情况下2倍ATR时的加仓策略        |   20867.4  |    28315.8 |         60 |         32 |         28 |   0.533333 |              305.168 |              652.107 |             -91.3329 | 3.34 |  -0.267097 |        2293.85 |
| ATR波幅通道+最多持仓天数+2倍ATR加仓的策略             |   19554.9  |    30012.2 |         61 |         30 |         31 |   0.491803 |              284.592 |              651.83  |             -70.8005 | 4.02 |  -0.260688 |        2330.22 |
| ATR波幅通道+最多持仓天数+2倍ATR加仓的策略(2019年数据) |    3790.53 |    13610.8 |         13 |          9 |          4 |   0.692308 |              271.289 |              421.17  |             -65.9443 | 4.11 |  -0.310902 |        1372.12 |


# 策略集合

## 均线策略

* [x] 📈[短期均线穿越长期均线（双均线）](策略测试-均线策略-短期均线穿越长期均线（双均线）.ipynb)
    > 买入：短期均线(10日)上穿长期均线(20日)
    > 
    > 卖出：长期均线(20日)上穿短期均线(10日)
* [x] [价格穿越均线（双均线）](策略测试-均线策略-价格穿越均线（双均线）.ipynb) 
    > 买入：(收盘价上穿10日均线 & 收盘价在20日均线上) | (收盘价上穿20日均线 & 收盘价在10日均线上)
    > 
    > 卖出：10日均线下穿收盘价 | 20日均线下穿收盘价
* [x] [均线方向（双均线）](策略测试-均线策略-均线方向（双均线）.ipynb)
    > 买入：两条均线（10日，20日）当日数据>昨日数据>前日数据
    > 
    > 卖出：两条均线（10日，20日）当日数据<昨日数据<前日数据

## 通道策略

* [ ] [均线百分比通道]()
    > 买入：
    > 
    > 卖出：
* [x] 📈[布林带通道](策略测试-通道策略-布林带通道.ipynb) 
    > 买入：收盘价上穿布林带上轨（买入）
    > 
    > 卖出：收盘价下穿布林带中轨（卖出）
    > 
    > `使用30日线，上下1.5倍标准差`
* [x] 📈[ATR波幅通道](策略测试-通道策略-ATR波幅通道.ipynb)
    > 买入：收盘价上穿20日移动均线+20日ATR
    > 
    > 卖出：收盘价下穿20日移动均线+20日ATR
* [x] [高低价通道](策略测试-通道策略-高低价通道.ipynb)
    > 买入：收盘价高于前30日最高收盘价
    > 
    > 卖出：收盘价低于前10日最低收盘价

### 简单测试

|                                         |   盈利交易平均盈利比率 |   最大盈利比率 |   亏损交易平均亏损比率 |   最大亏损比率 |   平均盈亏比率 |   交易次数 |   总天数 |   平均持仓天数 |   R(平均利润/平均损失) |
|:----------------------------------------|-----------------------:|---------------:|-----------------------:|---------------:|---------------:|-----------:|---------:|---------------:|-----------------------:|
| 简单测试-短期均线穿越长期均线（双均线） |               0.197792 |         0.8529 |             -0.0469693 |      -0.109115 |      0.0642859 |         33 |     1442 |        20.8485 |                2.25487 |
| 简单测试-价格穿越均线（双均线） |               0.106895 |       0.526032 |             -0.0317964 |           -0.1 |      0.0149366 |         92 |     1442 |        6.92391 |               0.400861 |
| 简单测试-均线方向（双均线） |               0.181977 |       0.896483 |             -0.0658363 |      -0.415899 |      0.0286772 |        763 |     1442 |        18.6855 |                0.26055 |
| 简单测试-通道策略-布林带通道 |               0.262513 |       0.726888 |             -0.0618243 |      -0.124599 |      0.0690488 |         57 |     1442 |        23.4035 |                1.32005 |
| 简单测试-通道策略-ATR波幅通道 |               0.212668 |       0.699342 |             -0.0762628 |      -0.212726 |      0.0269269 |         70 |     1442 |        26.2571 |               0.310914 |
| 简单测试-通道策略-高低价通道 |               0.113351 |       0.357523 |             -0.0865514 |      -0.274962 |      -0.013083 |        117 |     1442 |        16.3333 |               0.011991 |

### 回测

|                                     |   盈亏总额 |   最终价值 |   交易次数 |   盈利次数 |   亏损次数 |   盈利比率 |   每笔交易平均盈亏额 |   盈利交易平均盈利额 |   亏损交易平均亏损额 |    R |   最大回撤 |   买入平均花费 |
|:------------------------------------|-----------:|-----------:|-----------:|-----------:|-----------:|-----------:|---------------------:|---------------------:|---------------------:|-----:|-----------:|---------------:|
| 📈回测-短期均线穿越长期均线（双均线） |    6820.67 |    15611.4 |         27 |         15 |         12 |   0.555556 |              207.763 |              454.711 |             -100.922 | 2.06 |  -0.163974 |        2217.06 |
| 回测-价格穿越均线（双均线） |    7281.94 |    10811.6 |         79 |         24 |         55 |   0.303797 |              10.2673 |              303.414 |             -117.651 | 0.09 |  -0.278277 |        2607.59 |
| 回测-均线方向（双均线） |    25261.8 |    12046.1 |        352 |        137 |        215 |   0.389205 |              15.1356 |              184.393 |             -92.7167 | 0.16 |  -0.465173 |        2223.76 |
| 📈回测-通道策略-布林带通道 |    12062.4 |    19589.8 |         39 |         17 |         22 |   0.435897 |              245.814 |              709.552 |             -112.528 | 2.18 |  -0.232387 |        2501.61 |
| 📈回测-通道策略-ATR波幅通道 |    16441.3 |    24605.9 |         52 |         28 |         24 |   0.538462 |              280.795 |              587.189 |              -76.665 | 3.66 |  -0.223107 |        2209.86 |
| 回测-通道策略-高低价通道 |    6721.25 |    12505.1 |         53 |         18 |         35 |   0.339623 |              47.2479 |              373.403 |             -120.489 | 0.39 |  -0.228241 |        2237.59 |


